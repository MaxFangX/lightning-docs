---
layout: page
title: Stage 2 - Web Client
---

In this section we will learn how to set up and interact with `lnd` using a
[web client](https://github.com/mably/lncli-web) built by [Francois
Mably](https://github.com/mably). Setup instructions are courtesy of the
creator himself. Before beginning this step make sure you have `node` and `npm`
installed.

### Setting up the LND web client

```bash
# Clone the repo and move into it:
git clone https://github.com/mably/lncli-web
cd lncli-web

# Install dependencies
npm install

# Setup default configuration files
"./node_modules/.bin/gulp" bundle
```

### Setting up LND and BTCD

`lnd` should be started with the wallet encryption and macaroons options disabled, but in the previous [Stage 1 Tutorial](/tutorial/01-lncli) we only disabled macaroons. This means that we have to edit the `lnd.conf` we previously configured in Stage 1 tutorial. Considering we're using the local `simnet` blockchain, the suggestion is to start over from the beginning. Be forgiving, because the setting up procedure is going to be long and a little bit boring. Take it as a way to review most of what you learnt in Stage 1 tutorial.

First, delete any content from Alice, Bob and Charlie directories:

```bash
# delete alice's directory content
cd $GOPATH/dev/alice
rm -rf test_*

# delete bob's directory content
cd $GOPATH/dev/bob
rm -rf test_*

# delete charlie's directory content
cd $GOPATH/dev/charlie
rm -rf test_*
```

Then edit the `lnd.conf` file to add the `noencryptwallet` option:

```bash
[Application Options]
datadir=test_data
logdir=test_log
debuglevel=info
debughtlc=true
no-macaroons=true
noencryptwallet=true

[Bitcoin]
bitcoin.simnet=1
bitcoin.active=1
bitcoin.rpcuser=kek
bitcoin.rpcpass=kek
```

> NOTE: Mac OS X: ~/Library/Application Support/Lnd/lnd.conf; POSIX OSes: ~/.lnd/lnd.conf; Windows: $LOCALAPPDATA/Lnd/data

Taking into account that the current NodeJS gRPC module implementation does not support P-521 kind of certificates, which are the ones auto-generated by lnd, you need to manually regenerate a compatible version of them (i.e. P-256) as follows:

```bash
# Enter the Lnd home directory, located by default at ~/.lnd on Linux or
# /Users/[username]/Library/Application Support/Lnd/ on Mac OSX
cd ~/.lnd
openssl ecparam -genkey -name prime256v1 -out tls.key
openssl req -new -sha256 -key tls.key -out csr.csr -subj '/CN=localhost/O=lnd'
openssl req -x509 -sha256 -days 3650 -key tls.key -in csr.csr -out tls.cert
rm csr.csr
```

Finally copy the generated certificate file into lncli-web directory:

```bash
cp tls.cert <lncli-web_directory>/lnd.cert
```

#### Configure btcd.conf and btcctl.conf

Let's now configure `btcd` and `btcctl` to make things simpler. First delete any generated content during the Stage 1 from the `~/.btcd` directory (or `~/Library/Application Support/Btcd` on Mac OS X):

```bash
# delete the .btcd directory
rm -rf ~/.btcd
```

Recreate the above directory and create a `btcd.conf` inside it:

```bash
mkdir ~/.btcd
touch ~/.btcd/btcd.conf
```

> NOTE: mutatis mutandis, make the same thing in Mac OS X or Windows OSes

Edit the `btcd.conf` file as follows:

```bash
[Application Options]
simnet=1
rpcuser=kek
rpcpass=kek
txindex=1
```

Configure `btcctl.conf` as well:

```bash
mkdir ~/.btcctl
touch ~/.btcctl/btcctl.conf
```

> NOTE: mutatis mutandis, make the same thing in Mac OS X or Windows OSes

and edit `btcctl.conf` as follows:

```bash
[Application Options]
simnet=1
rpcuser=kek
rpcpass=kek
```

We are done and ready to launch `btcd` and a cluster of `lnd`s on top of it as we did in Stage 1 tutorial.

### Run btcd

Run `btcd` as usual:

```bash
cd $HOME # you can run btcd from any directory
btcd
2017-12-28 12:27:42.558 [INF] BTCD: Version 0.12.0-beta
2017-12-28 12:27:42.558 [INF] BTCD: Loading block database from '/home/mimmo/.btcd/data/simnet/blocks_ffldb'
2017-12-28 12:27:42.563 [INF] BTCD: Block database loaded
2017-12-28 12:27:42.566 [INF] INDX: Transaction index is enabled
2017-12-28 12:27:42.566 [INF] INDX: cf index is enabled
2017-12-28 12:27:42.566 [INF] INDX: Catching up indexes from height -1 to 0
2017-12-28 12:27:42.566 [INF] INDX: Indexes caught up to height 0
2017-12-28 12:27:42.566 [INF] CHAN: Chain state (height 0, hash 683e86bd5c6d110d91b94b97137ba6bfe02dbbdb8e3dff722a669b5d69d77af6, totaltx 1, work 2)
2017-12-28 12:27:42.566 [INF] RPCS: Generating TLS certificates...
2017-12-28 12:27:42.591 [INF] RPCS: Done generating TLS certificates
2017-12-28 12:27:42.601 [INF] AMGR: Loaded 0 addresses from file '/home/mimmo/.btcd/data/simnet/peers.json'
2017-12-28 12:27:42.601 [INF] RPCS: RPC server listening on 127.0.0.1:18556
2017-12-28 12:27:42.601 [INF] CMGR: Server listening on [::]:18555
2017-12-28 12:27:42.601 [INF] CMGR: Server listening on 0.0.0.0:18555
```

### Run Alice, Bob and Charlie lnd

As we did in Stage 1 tutorial, we can now lunch the cluster of `lnd`s for Alice, Bob and Charlie:

```bash
# from a new terminal for Alice
cd $GOPATH/dev/alice
lnd --rpcport=10001 --peerport=10011 --restport=8001
2017-12-28 12:42:21.305 [INF] LTND: Version 0.3.0-alpha
...
2017-12-28 12:42:23.795 [INF] CMGR: Server listening on [::]:10011

# from a new terminal for Bob
cd $GOPATH/dev/bob
lnd --rpcport=10002 --peerport=10012 --restport=8002
2017-12-28 12:44:30.704 [INF] LTND: Version 0.3.0-alpha
...
2017-12-28 12:44:33.295 [INF] CMGR: Server listening on [::]:10012

# from a new terminal for Charlie
cd $GOPATH/dev/charlie
lnd --rpcport=10003 --peerport=10013 --restport=8003
2017-12-28 12:46:14.287 [INF] LTND: Version 0.3.0-alpha
...
2017-12-28 12:46:16.799 [INF] CMGR: Server listening on [::]:10013
```

### Create addresses

As you should remember from Stage 1 tutorial, before funding the peers we need to create new addresses for them by using the `lncli` command line client. Let's do it again:

> NOTE: copy down the generated addresses, because you'll need them later when funding peers

```bash
# from a new terminal
cd $GOPATH/dev/alice
lncli-alice newaddress np2wkh
{
    "address": "rX4mANQmUzoTADdQ4htinMJoTQPaexYvGe"
}
# check Alice's balance
lncli-alice walletbalance
{
    "total_balance": "0",
    "confirmed_balance": "0",
    "unconfirmed_balance": "0"
}

# from a new terminal
cd $GOPATH/dev/bob
lncli-bob newaddress np2wkh
{
    "address": "rtpCLSQqEdNPwNoj9zFvXzy5Ej1qqPuv9e"
}
# check Bob's balance
lncli-bob walletbalance
{
    "total_balance": "0",
    "confirmed_balance": "0",
    "unconfirmed_balance": "0"
}

# from a new terminal
cd $GOPATH/dev/charlie
lncli-charlie newaddress np2wkh
{
    "address": "rWaEQ1yTGMyfeeVVE9RrLCPoHnuFchzBKr"
}
# check Charlie's balance
lncli-charlie walletbalance
{
    "total_balance": "0",
    "confirmed_balance": "0",
    "unconfirmed_balance": "0"
}
```

### Fund Alice and Charlie

As we did in Stage 1 tutorial, to fund peers we need to stop the running `btcd` and to rerun it with the `--miningaddr` option set to the address of each peer we want to fund. If you're not quick in rerunning btcd after having stopped if, the running lnd processes for Alice, Bob and Charlie, they'll go in timeout. I strongly suggest to stop them all before stopping btcd.

```bash
# from alice's terminal
lncli-alice stop

# from bob's terminal
lncli-bob stop

# from charlie's terminal
lncli-charlie stop

# from a new terminal
cd $HOME # could be any directory
btcctl stop
btcd stopping.
```

You'll see that the previously running `btcd` has been stopped.
Let's start by funding Alice's address:

```bash
# from the same terminal where you launched btcd the first time
btcd --miningaddr=<ALICE ADDRESS>
```  

Go back to the terminal where you stopped `btcd` and generate 400 blocks:

```bash
# from the terminal where you stopped btcd
btcctl generate 400
[
  "7d62d49522595b7cd05853efb5c7b88ef9b0cd0c33adc147bb2fec7187403e56",
   ...
  "126dfa3c1e38d7467baebecea0a08a0e2a49f474cf585c2445df4b022d7785af"
]
```

Repeat the above procedure for Charlie's address. As we did in the Stage 1 tutorial, we're not going to fund Bob's address.

```bash
btcctl stop

# from the same terminal where you launched btcd the first time
btcd --miningaddr=<CHARLIE ADDRESS>
```  

Go back to the terminal where you stopped `btcd` and generate 100 blocks to fund Charlie as well:

```bash
# from the terminal where you stopped btcd
btcctl generate 100
[
  "52b54c972ae0b97b06cfc21b13c3fcf385d750c14fc32f29f9c80dcda23bb222",
  ...
  "1176c0c51d3e87e0fb0fb82f460035128144ef86a3c3bbccc539103e7d8a230f"
]
```

You can now restart all the three LND's:

```bash
# from the terminal where you previously launched Alice's lnd
lnd --rpcport=10001 --peerport=10011 --restport=8001

# from the terminal where you previously launched Bob's lnd
lnd --rpcport=10002 --peerport=10012 --restport=8002

# from the terminal where you previously launched Charlie's lnd
lnd --rpcport=10003 --peerport=10013 --restport=8003
```

If you're curious about the new balance of each peers you can check them out as you did in Stage 1 tutorial:

```bash
# alice's balance
lncli-alice walletbalance
{
    "total_balance": "2000000000000",
    "confirmed_balance": "2000000000000",
    "unconfirmed_balance": "0"
}

# bob's balace (0 BTC)
lncli-bob walletbalance
{
    "total_balance": "0",
    "confirmed_balance": "0",
    "unconfirmed_balance": "0"
}

# charlie's balance
lncli-charlie walletbalance
{
    "total_balance": "5000000000",
    "confirmed_balance": "5000000000",
    "unconfirmed_balance": "0"
}
```

### Running the LND web client

After a lot of set up, we're ready to go with the web client we already installed and set up at the very beginning of this Stage 2 tutorial.

You can attach the web client to whichever `lnd` you want. To be coherent with the workflow described in Stage 1 tutorial, we're going to attach it to the Alice's lnd


```bash
# from the terminal where you installed lncli-web
cd <lncli-web_directory>

# Check out the available command line arguments
node server --help

# run the server
node server --lndhost=localhost:10001
...
info:    App listening on localhost port 8280
```

As you see, the server inform you that the web app is listening on port 8280 of the localhost. Open up [`http://localhost:8280/`](http://localhost:8280/) in your browser to see the web dashboard.

### Poking around

Now would be a good time to repeat the Stage 1 workflow, except this time we're going to do it through the web dashboard. In the `Node Info` panel of the `Node and Network Information` section, you should see that block height is 500, the number of blocks we previously generated to fund Alice and Charlie. You should also see that there are no current active o pending channels. The `Network Info` panel inform you there is just one connected node (i.e. Alice). The total network capacity is 0, because there are still no active channels. In the `Wallet and Channel Balances` section you can see current Alice's balances, wallet balance and channel one.

#### Connect Alice with Bob

In the `Peers` section you see there are no connected peers. Let's connect Alice with Bob. As you remember from Stage 1, to connect to a peer you need to know the public-key and the address and the port of the lnd node you want to connect to. Go back to the Bob's terminal to get the public-key:

```bash
lncli-bob getinfo
{
    "identity_pubkey": <BOB PUBKEY>,
    "alias": "",
    "num_pending_channels": 0,
    "num_active_channels": 0,
    "num_peers": 0,
    "block_height": 500,
    "block_hash": "1176c0c51d3e87e0fb0fb82f460035128144ef86a3c3bbccc539103e7d8a230f",
    "synced_to_chain": false,
    "testnet": false,
    "chains": [
        "bitcoin"
    ]
}
```

Now click the `+` icon in the `Connected peers` panel and paste the above public-key and the `localhost:10012`. `10012` is the peer address we assigned to Bob when we started his lnd node. As soon as you click the `Connect Peer` button you'll see the `Connected peers` panel being updated.

#### Open a channel between Alice and Bob

We can now open a payment channel from Alice to Bob. Click the `+` icon in the  'Active Channels' panel and select Bob's public-key from the drop-down menu   in the `Node Pubkey` field. Type `1000000` in the `Local amount` field and `0` in the `Push amount` field. Then click the `Open Channel` button. You'll receive a notification about not being able to create the channel. Go to the the terminal where you previously run the block generation and generate 6 new blocks.

```bash
btcctl generate 6
```
> NOTE: The last time we run btcd we set Charlie's address as the miningaddr. So, Charlie is going to earn all the mined BTC.   

This step is needed to create the funding transaction in the simnet blockchain as you can verify by yourself by refreshing the `Active channels` panel. Note as the local balance is `991312`, because it has been payed a fee of `8688` Satoshi to the miner of the block recording the payment funding transaction (i.e payment channel).

#### Sending single hop payments

As from the Stage 1 tutorial, let Bob create and payment request from the terminal:

```bash
lncli-bob addinvoice --value=100000
{
	"r_hash": "9761a5336f8d5d4cd6f59a5581bc7f0f0316c114532f4f1970b85f4e1cf8b2f0",
	"pay_req": <PAYMENT_REQ>
}
```

Copy the payment request code from the terminal, click the `+` icon from the `Payment` panel of the `Payments/Invoices` section of the dashboard and paste into the `Payment request` field the copied request. You should immediately see the detail of the payment request. Click the `Send Payment` button. This off-chain payment from Alice to Bob is almost instantaneous as you can verify by refreshing the `Active channels` panel.

#### Multi-hop payments

Considering that the running `lncli-web` app is attached to Alice's LND node, to setup a multi-hop off-chain payment we need to use again the terminals.

##### Connect Charlie to Bob

First we need to create a connection between Charlie and Bob, as we did in the Stage 1 tutorial.

```bash
lncli-charlie connect <BOB_PUBKEY>@localhost:10012
{
    "peer_id": 0
}

# check charlie's peers
lncli-charlie listpeers
{
    "peers": [
        {
            "pub_key": <BOB_PUBKEY>,
            "peer_id": 1,
            "address": "127.0.0.1:10012",
            "bytes_sent": "149",
            "bytes_recv": "149",
            "sat_sent": "0",
            "sat_recv": "0",
            "inbound": true,
            "ping_time": "0"
        }
    ]
}

# check bob's peers. He know has a connection with both Alice and Charlie
lncli-bob listpeers
{
    "peers": [
        {
            "pub_key": <ALICE_PUBKEY>,
            "peer_id": 1,
            "address": "127.0.0.1:47512",
            "bytes_sent": "3057",
            "bytes_recv": "4802",
            "sat_sent": "0",
            "sat_recv": "100000",
            "inbound": false,
            "ping_time": "644"
        },
        {
            "pub_key": <CHARLIE_PUBKEY>,
            "peer_id": 2,
            "address": "127.0.0.1:48902",
            "bytes_sent": "149",
            "bytes_recv": "149",
            "sat_sent": "0",
            "sat_recv": "0",
            "inbound": false,
            "ping_time": "0"
        }
    ]
}
```

##### Open a channel from Charlie to Bob

We now need to open a payment channel from Charlie to Bob.

```bash
lncli-charlie openchannel --node_key=<BOB_PUBKEY> --local_amt=800000 --push_amt=200000
{
	"funding_txid": "f9bb66231aca688698a1429cb2be7326ce0161f6f0ca681e6b669cb0769f32a9"
}
```

This time we also push `200000` Satoshi as a contribution by Bob to the funding transaction. As usual, this transaction has to be recorded into the blockchain, so let's generate the next 6 required blocks.

```bash
btcctl generate 6
[
  "064ba46271cc3e8d2229dd986813796754c4a7b1a319a4394783a413983cda20",
  ...
  "67e2a02f23c66254435915b6346cd10fbfa3021c3583403274c176ae4e97bf9b"
]
```

If you now visit the dashboard, you should see the updated information in the `Network info` panel: there are now 3 nodes, 2 channels and the total capacity of the channel network is `1800000` (i.e. the sum of the capacity of the two established channels).

##### Create the invoice by Charlie

Let's create an invoice by Charlie in such a way that Alice will be able to pay the generated payment request without being directly connected with Charlie.

```bash
lncli-charlie addinvoice --value=10000
{
	"r_hash": "c9d8acce1d5b939b1b97536d1c23e0c8216f49cc2376de7d89a32608bc4bb1c2",
	"pay_req": <PAYMENT_REQ>
}
```

Copy the payment request identifier.

#### Alice pays Charlie

Go back to the dashboard and click the `+` from the `Payment` panel. Paste the copied payment request in the corresponding field. You should immediately see the payment detail, including Charlie's public-key as the destination of the payment. Click the `Send payment` button. You should now see an almost instant update of the `Active channels` and `Payments` panels:

* the value of the local balance is know `881310` (remote balance is `110001`).
* there is a new payment in the `Payment` panel.

### Other peers's view

As said, when we started the `lncli-web` app we attached it to Alice's LND node. But we could also attach it to Bob or Charlie's nodes.

Close the browser window, stop the running node server (CTRL-C/CMD-C) and rerun it by passing the LND address of Bob's node.

```bash
node server --lndhost=localhost:10001
...
info:    App listening on localhost port 8280
^C
# connect the node server to Bob's LND node
node server --lndhost=localhost:10002
...
info:    App listening on localhost port 8280
```

You now see the Bob's view of the network. Do the same with Charlie's view.

```bash
node server --lndhost=localhost:10002
...
info:    App listening on localhost port 8280
^C

# connect the node server to Charlie's LND node
node server --lndhost=localhost:10003
...
info:    App listening on localhost port 8280
```

### Conclusion

Feel free to try the dashboard on your own - the web dashboard is intuitive enough that we don't need step by step instructions for it.

When done, stop the node server, all the LND's nodes and finally the `btcd` daemon.
> NOTE: The LND wallet is coming soon! Sign up for our newsletter at the bottom
of our [community page](//lightning.community#mc-embedded-subscribe-form)

### Moving on to Step 3

By now, you should have gained familiarity with the web client.
In [Stage 3](/tutorial/03-rpc-client), we will learn how to set up a gRPC
client for programmatic access to our `lnd` nodes.

#### Navigation
- [Proceed to Stage 3 - RPC Client](/tutorial/03-rpc-client)
- [Return to Stage 1 - Setting up a local cluster](/tutorial/01-lncli)
- [Return to main tutorial page](/tutorial/)

### Questions
- Join the #dev-help channel on our [Community
  Slack](https://join.slack.com/t/lightningcommunity/shared_invite/MjI4OTg3MzQ4MjI2LTE1MDMxNzM1NTMtNjlmOGYzOTI1Ng)
- Join IRC:
  [![Irc](https://img.shields.io/badge/chat-on%20freenode-brightgreen.svg)](https://webchat.freenode.net/?channels=lnd)
